
<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8" />
  <title>SaiSUPPORT-Alnukhba.IT.SLO - Website Status Checker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>


    table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  font-size: 14px;
}

th, td {
  border: 1px solid #555;
  padding: 8px 12px;
  text-align: left;
}

th {
  background-color: #333;
  color: #fff;
}

tbody tr:nth-child(even) {
  background-color: #1e1e1e;
}

tbody tr:nth-child(odd) {
  background-color: #2a2a2a;
}

    #status-bar {
   position: fixed;
   top: 0;
   width: 90%;
   background-color: #222;
   color: white;
   font-size: 12px;
   padding: 4px 10px; /* ← قلل الـ padding */
   display: flex;
   justify-content: space-between;
   align-items: center;
   height: 30px; /* ← قلل الارتفاع هنا */
   box-shadow: 0 -2px 5px rgba(0,0,0,0.3);
 }

   body {
     font-family: sans-serif;
     background: #121212;
     color: #fff;
     padding: 20px;
     transition: background-color 0.3s ease;
   }
   h1, h2, h3 {
     color: #fff;
   }

   .card-container {
     display: flex;
     flex-wrap: wrap;
     gap: 16px;
     margin-top: 20px;
   }

   .card {
     background: #1e1e1e;
     border-radius: 12px;
     padding: 16px;
     width: 220px;
     box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
     transition: transform 0.2s ease-in-out;
   }

   .card:hover {
     transform: translateY(-5px);
   }

   .site-name {
     font-size: 18px;
     font-weight: bold;
     margin-bottom: 10px;
   }

   .status {
     font-size: 16px;
     margin-bottom: 6px;
   }

   .status.online {
     color: #00ff7f;
   }

   .status.offline {
     color: #ff4c4c;
   }

   .latency {
     font-size: 14px;
     color: #ccc;
   }

   .countdown {
     font-size: 16px;
     margin: 10px 0;
   }

   .charts-grid {
     display: flex;
     flex-wrap: wrap;
     gap: 20px;
     justify-content: flex-start;
   }

   .chart-container {
     flex: 1 1 calc(33.33% - 20px);
     background: #1e1e1e;
     padding: 10px;
     border: 1px solid #444;
     min-width: 250px;
     max-width: 33.33%;
   }

   canvas {
     width: 100% !important;
     height: 200px !important;
   }
  </style>

</head>


<body>

<div id="status-bar">
  <p id="title">Website Status Checker</p>
  <p id="uptime"></p>
  <p id="Ba'quba-time"></p>
</div>

<!-- بطاقات المواقع -->
<div class="card-container" id="cardContainer"></div>

<h2>Latency Charts</h2>
<div class="charts-grid" id="chartsContainer"></div>

<h2>Offline Log</h2>
<table>
  <thead>
  <tr>
    <th>Website</th>
    <th>Time Went Offline</th>
  </tr>
  </thead>
  <tbody id="offlineLog"></tbody>
</table>

<script>

  function updateBaghdadTime() {
  const now = new Date().toLocaleString("en-US", {
    timeZone: "Asia/Baghdad",
    hour12: false
  });
  document.getElementById("Ba'quba-time").textContent =
    `Ba'quba Time: ${now}`;
}

setInterval(updateBaghdadTime, 1000);
  const startTime = Date.now();

function updateUptime() {
  const now = Date.now();
  const elapsed = Math.floor((now - startTime) / 1000);
  const hours = Math.floor(elapsed / 3600);
  const minutes = Math.floor((elapsed % 3600) / 60);
  const seconds = elapsed % 60;
  document.getElementById("uptime").textContent =
    `uptime : ${hours}h ${minutes}m ${seconds}s`;
}

setInterval(updateUptime, 1000);
  const sites = {
    youtube: "https://www.youtube.com/",
    instagram: "https://www.instagram.com",
    facebook: "https://www.facebook.com",
    microsoft: "https://www.microsoft.com",
    x: "https://www.x.com",
    vodu: "https://movie.vodu.me/index.php?do=view&type=post&id=11481#",
    tiktok: "https://www.tiktok.com/explore",
 netflix : "https://www.netflix.com/iq-en/",
pinterest: "https://www.pinterest.com/"
  };

  const cardContainer = document.getElementById("cardContainer");
  const chartsContainer = document.getElementById("chartsContainer");
  const offlineLogTable = document.getElementById("offlineLog");
  const countdownEl = document.getElementById("countdown");


  let latencyHistory = {};
  let chartObjects = {};
  let flashInterval = null;

  // --- Chart & Card Initialization ---
  function initializeCharts() {
    for (const name in sites) {
      latencyHistory[name] = [];

      const container = document.createElement("div");
      container.className = "chart-container";

      const title = document.createElement("h3");
      title.textContent = name.toUpperCase();
      container.appendChild(title);

      const canvas = document.createElement("canvas");
      canvas.id = `chart-${name}`;
      container.appendChild(canvas);

      chartsContainer.appendChild(container);

      chartObjects[name] = new Chart(canvas.getContext("2d"), {
        type: "line",
        data: {
          labels: [],
          datasets: [{
            label: "Latency (ms)",
            data: [],
            borderColor: "#4fc3f7",
            backgroundColor: "rgba(79,195,247,0.2)",
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  }

  function updateChart(name, latency) {
    const chart = chartObjects[name];
    const now = new Date().toLocaleTimeString();
    const history = latencyHistory[name];

    if (history.length >= 10) {
      history.shift();
      chart.data.labels.shift();
      chart.data.datasets[0].data.shift();
    }

    history.push(latency);
    chart.data.labels.push(now);
    chart.data.datasets[0].data.push(latency);
    chart.update();
  }

  // --- Offline Log Handling ---
  function updateOfflineLog(name) {
    const logs = JSON.parse(localStorage.getItem("offlineLog") || "[]");
    const now = new Date().toLocaleString();
    logs.push({ name, time: now });
    localStorage.setItem("offlineLog", JSON.stringify(logs));
    localStorage.setItem("offlineLogDate", new Date().toISOString());
    renderOfflineLog();
  }

  function clearOfflineLogIfExpired() {
    const savedDate = localStorage.getItem("offlineLogDate");
    if (savedDate) {
      const saved = new Date(savedDate);
      const now = new Date();
      const diffDays = Math.floor((now - saved) / (1000 * 60 * 60 * 24));
      if (diffDays >= 3) {
        localStorage.removeItem("offlineLog");
        localStorage.removeItem("offlineLogDate");
      }
    }
  }

  function renderOfflineLog() {
    const logs = JSON.parse(localStorage.getItem("offlineLog") || "[]");
    offlineLogTable.innerHTML = "";
    logs.forEach(log => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${log.name}</td><td>${log.time}</td>`;
      offlineLogTable.appendChild(row);
    });
  }

  // --- Card update & offline background flash ---
  function updateCard(name, status, latency) {
    let card = document.getElementById(`card-${name}`);
    if (!card) {
      card = document.createElement("div");
      card.className = "card";
      card.id = `card-${name}`;
      cardContainer.appendChild(card);
    }

    card.innerHTML = `
      <div class="site-name">${name.toUpperCase()}</div>
      <div class="status ${status.toLowerCase()}">Status: ${status}</div>
      <div class="latency">Latency: ${latency === "N/A" ? "N/A" : latency + " ms"}</div>
    `;

    checkOfflineSites();
  }

  function startFlashingRed() {
    if (flashInterval) return;
    let isRed = false;
    flashInterval = setInterval(() => {
      document.body.style.backgroundColor = isRed ? "#121212" : "#8B0000";
      isRed = !isRed;
    }, 2000);
  }

  function stopFlashingRed() {
    if (flashInterval) {
      clearInterval(flashInterval);
      flashInterval = null;
      document.body.style.backgroundColor = "#121212";
    }
  }

  function checkOfflineSites() {
    const offlineCards = document.querySelectorAll(".card .status.offline");
    if (offlineCards.length > 0) {
      startFlashingRed();
    } else {
      stopFlashingRed();
    }
  }

  // --- Fetch with 5 seconds timeout ---
  function fetchWithTimeout(url, timeout = 5000) {
    const controller = new AbortController();
    const signal = controller.signal;
    return new Promise((resolve, reject) => {
      const timer = setTimeout(() => {
        controller.abort();
        reject(new Error("Timeout"));
      }, timeout);

      fetch(url, { mode: 'no-cors', signal })
        .then(resolve)
        .catch(reject)
        .finally(() => clearTimeout(timer));
    });
  }

  // --- Check one site only ---
  function checkSite(name) {
    const url = sites[name];
    const start = performance.now();
    return fetchWithTimeout(url, 5000)
      .then(() => {
        const latency = Math.round(performance.now() - start);
        updateCard(name, "Online", latency);
        updateChart(name, latency);
      })
      .catch(() => {
        updateCard(name, "Offline", "N/A");
        updateChart(name, 0);
        updateOfflineLog(name);
      });
  }

  // --- Check sites one by one sequentially with 2 seconds delay ---
  async function checkSitesSequentially() {
    const names = Object.keys(sites);
    for (const name of names) {
      await checkSite(name);
      await new Promise(res => setTimeout(res, 2000)); // انتظر 2 ثانية قبل الفحص التالي
    }
    // بعد انتهاء جميع المواقع، أعد ضبط العد التنازلي للـ 15 ثانية
    countdown = 15;
    // أعد بدء الفحص من جديد
    checkSitesSequentially();
  }

  // Initialization
  clearOfflineLogIfExpired();
  initializeCharts();
  renderOfflineLog();

  // ابدأ الفحص المتسلسل
  checkSitesSequentially();

  // عداد التنازلي للعرض فقط

  // --- دالة إضافة موقع جديد مع التحقق الفوري ---
  function addSite(name, url) {
    sites[name] = url;

    if (!document.getElementById(`card-${name}`)) {
      const card = document.createElement("div");
      card.className = "card";
      card.id = `card-${name}`;
      card.innerHTML = `
        <div class="site-name">${name.toUpperCase()}</div>
        <div class="status offline">Status: Unknown</div>
        <div class="latency">Latency: N/A</div>
      `;
      cardContainer.appendChild(card);
    }

    if (!chartObjects[name]) {
      latencyHistory[name] = [];

      const container = document.createElement("div");
      container.className = "chart-container";

      const title = document.createElement("h3");
      title.textContent = name.toUpperCase();
      container.appendChild(title);

      const canvas = document.createElement("canvas");
      canvas.id = `chart-${name}`;
      container.appendChild(canvas);

      chartsContainer.appendChild(container);

      chartObjects[name] = new Chart(canvas.getContext("2d"), {
        type: "line",
        data: {
          labels: [],
          datasets: [{
            label: "Latency (ms)",
            data: [],
            borderColor: "#4fc3f7",
            backgroundColor: "rgba(79,195,247,0.2)",
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  }
</script>
</body>
</html>
